Fixes and code consistency improvements based on analysis provided by lgtm.org
